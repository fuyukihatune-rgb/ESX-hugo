{{ define "main" }}
  <div class="container">
    <div class="site-title-wrapper">
      <h1 class="site-title">Empowerment Society X</h1>
    </div>

    {{ $discussionsURL := .Site.Params.discussions_url | default "https://github.com/fuyukihatune-rgb/ESX-hugo/discussions" }}
    <section class="hero">
      <h1>自由で開かれたディスカッションハブへ。</h1>
      <p class="lead">
        Empowerment Society X は、肩書きや立場に関係なくアイデアを共有できるオンラインフォーラムです。
        テーマの大小を問わず、読みやすいコンテンツと健全なコミュニケーションを歓迎します。
      </p>
      <blockquote class="quote">
        <p>「誰もが安心して話せる場所を整えることが、創造的な対話の前提条件である。」</p>
        <cite>— Community Charter</cite>
      </blockquote>
      <div class="hero-actions">
        <a class="cta-button" href="{{ relLangURL "contribute/" }}">寄稿フォームを開く</a>
        <a class="cta-button secondary" href="{{ $discussionsURL }}" target="_blank" rel="noopener">GitHub Discussions で話す</a>
      </div>
    </section>

    {{ $categorySlice := slice }}
    {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
      {{ $page := site.GetPage (printf "/categories/%s" (urlize $name)) }}
      {{ if $page }}
        {{ $categorySlice = $categorySlice | append (dict "name" $name "count" (len $taxonomy) "permalink" $page.RelPermalink) }}
      {{ end }}
    {{ end }}

    {{ $tagSlice := slice }}
    {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
      {{ $page := site.GetPage (printf "/tags/%s" (urlize $name)) }}
      {{ if $page }}
        {{ $tagSlice = $tagSlice | append (dict "name" $name "count" (len $taxonomy) "permalink" $page.RelPermalink) }}
      {{ end }}
    {{ end }}

    {{ if or (gt (len $categorySlice) 0) (gt (len $tagSlice) 0) }}
    <section class="card taxonomy-card">
      <div class="taxonomy-columns">
        {{ if gt (len $categorySlice) 0 }}
        <div class="taxonomy-block">
          <h2>トピック一覧</h2>
          <p class="taxonomy-text">気になるテーマを選んで、関連する投稿を一覧できます。</p>
          <div class="pill-group">
            {{ range first 6 (sort $categorySlice "count" "desc") }}
              <a class="pill" href="{{ .permalink }}">{{ .name }}<span class="pill-count">{{ .count }}</span></a>
            {{ end }}
          </div>
        </div>
        {{ end }}
        {{ if gt (len $tagSlice) 0 }}
        <div class="taxonomy-block">
          <h2>人気タグ</h2>
          <p class="taxonomy-text">関心のあるキーワードから投稿を探しましょう。</p>
          <div class="pill-group">
            {{ range first 8 (sort $tagSlice "count" "desc") }}
              <a class="pill secondary" href="{{ .permalink }}">#{{ .name }}<span class="pill-count">{{ .count }}</span></a>
            {{ end }}
          </div>
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    <section class="card">
      <h2>このフォーラムで大切にしていること</h2>
      <ul>
        <li><strong>オープンな編集プロセス</strong> — すべての記事や改善提案は GitHub 上で公開され、誰でも経緯を追えます。</li>
        <li><strong>バイアスの少ない表現</strong> — 特定の政治的立場に依存せず、事実と経験を中心に据えた投稿を目指します。</li>
        <li><strong>コラボレーション</strong> — アイデアの下書きから翻訳、デザイン改善まで、得意分野を持ち寄ってください。</li>
        <li><strong>アクセスのしやすさ</strong> — レスポンシブデザインと軽量な構成で、デバイスを問わず快適に閲覧できます。</li>
      </ul>
      <p>
        特別なスキルは必要ありません。執筆、校正、フィードバックのいずれでも参加できます。
      </p>
    </section>
    <section class="card">
      <h2>コミュニティガイドライン</h2>
      <ul>
        <li><strong>敬意を払う</strong> — 立場の違いを尊重し、個人攻撃をしないでください。</li>
        <li><strong>透明性</strong> — 情報源や前提条件を開示し、検証可能な形で共有します。</li>
        <li><strong>建設的なフィードバック</strong> — 批判ではなく改善提案を意識し、次のアクションにつながるコメントを。</li>
        <li><strong>安全とプライバシー</strong> — 個人情報を扱う際は十分に配慮し、公開範囲を意識してください。</li>
      </ul>
      <p>
        詳細は <a href="{{ relLangURL "contribution-guide/" }}">貢献ガイド</a> をご確認ください。
      </p>
    </section>

    {{/* 最新の投稿一覧を表示 */}}
    <section class="latest-posts">
      <h2>最新の投稿</h2>
      <div class="post-card-grid">
        {{ range first 3 (where .Site.RegularPages "Section" "posts") }}
          {{ partial "card.html" . }}
        {{ end }}
      </div>
    </section>

    <section class="card">
      <h2>コミュニティを支える</h2>
      <p>このフォーラムはコミュニティベースで運営されています。寄稿・レビュー・翻訳・デザイン改善など、時間と知識の共有が最大のサポートです。</p>
      <p>もし運営費の支援に興味があれば、代表 <strong>@ncc1030</strong> までお問い合わせください。暗号資産での支援は以下のアドレスで受け付けています。</p>
      <div class="address-box">
        <label>Ethereum (ETH)</label>
        <code class="addr">0x30ADadB8551CF95267Eff67988916C11DF431bF2</code>
      </div>
    </section>
  </div>
{{ end }}
